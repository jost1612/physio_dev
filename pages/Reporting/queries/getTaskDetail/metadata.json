{
  "gitSyncId": "685e483118280a5cf36d2a8a_93a48ff1-4f90-4d71-a8c6-f2c4017dfb04",
  "id": "Reporting_getTaskDetail",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- DYNAMISCHES PIVOT mit generischen Pastellfarben\nWITH employee_colors AS (\n  SELECT \n    e.id as employee_id,\n    e.name as employee_name,\n    \n    -- ðŸŽ¨ DYNAMISCHE HINTERGRUNDFARBE basierend auf Mitarbeiter-ID/Name\n    '#' ||\n    -- Rot-Komponente (Pastellbereich 230-250)\n    LPAD(UPPER(TO_HEX((230 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT), 1, 8))::bit(32)::BIGINT) % 20))::INTEGER)), 2, '0') ||\n    -- GrÃ¼n-Komponente (Pastellbereich 235-250) \n    LPAD(UPPER(TO_HEX((235 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT || 'G'), 1, 8))::bit(32)::BIGINT) % 15))::INTEGER)), 2, '0') ||\n    -- Blau-Komponente (Pastellbereich 240-255)\n    LPAD(UPPER(TO_HEX((240 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT || 'B'), 1, 8))::bit(32)::BIGINT) % 15))::INTEGER)), 2, '0')\n    as bg_color,\n    \n    -- ðŸŽ¨ ALTERNATIVE: Vordefinierte Palette mit Modulo-Wraparound\n    CASE (ROW_NUMBER() OVER (ORDER BY e.name) - 1) % 30\n      WHEN 0 THEN '#E0E7FF'   -- Lavendel\n      WHEN 1 THEN '#FCE7F3'   -- Rosa Pastell\n      WHEN 2 THEN '#ECFDF5'   -- Mint Pastell  \n      WHEN 3 THEN '#FEF3C7'   -- Gelb Pastell\n      WHEN 4 THEN '#DBEAFE'   -- Himmelblau Pastell\n      WHEN 5 THEN '#F3E8FF'   -- Lila Pastell\n      WHEN 6 THEN '#DCFCE7'   -- GrÃ¼n Pastell\n      WHEN 7 THEN '#FED7AA'   -- Pfirsich Pastell\n      WHEN 8 THEN '#E0F2FE'   -- Cyan Pastell\n      WHEN 9 THEN '#FDF2F8'   -- RosÃ© Pastell\n      WHEN 10 THEN '#F0FDF4'  -- Limette Pastell\n      WHEN 11 THEN '#FFFBEB'  -- Creme Pastell\n      WHEN 12 THEN '#EDE9FE'  -- Violett Pastell\n      WHEN 13 THEN '#ECFCCB'  -- HellgrÃ¼n Pastell\n      WHEN 14 THEN '#FEF7CD'  -- Zitrone Pastell\n      WHEN 15 THEN '#F1F5F9'  -- Grau Pastell\n      WHEN 16 THEN '#FFEAA7'  -- Honig Pastell\n      WHEN 17 THEN '#DDD6FE'  -- Indigo Pastell\n      WHEN 18 THEN '#A7F3D0'  -- Smaragd Pastell\n      WHEN 19 THEN '#FBCFE8'  -- Magenta Pastell\n      -- Erweiterte Palette (20-29)\n      WHEN 20 THEN '#FFF2CD'  -- Champagne\n      WHEN 21 THEN '#E8F5E8'  -- Seafoam\n      WHEN 22 THEN '#FFE4E1'  -- Misty Rose\n      WHEN 23 THEN '#F0F8FF'  -- Alice Blue\n      WHEN 24 THEN '#F5F5DC'  -- Beige\n      WHEN 25 THEN '#E6E6FA'  -- Lavender\n      WHEN 26 THEN '#FFF8DC'  -- Cornsilk\n      WHEN 27 THEN '#F0FFFF'  -- Azure\n      WHEN 28 THEN '#FDF5E6'  -- Old Lace\n      WHEN 29 THEN '#F5FFFA'  -- Mint Cream\n      ELSE '#F8FAFC'  -- Fallback\n    END as palette_color,\n    \n    -- âœ… INTELLIGENTE TEXTFARBE basierend auf generierter Hintergrundfarbe\n    CASE \n      -- FÃ¼r dynamisch generierte Farben (immer Pastellbereich) â†’ dunkler Text\n      WHEN (\n        -- Luminance der generierten Farbe berechnen\n        ((230 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT), 1, 8))::bit(32)::BIGINT) % 20)) * 299) +\n        ((235 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT || 'G'), 1, 8))::bit(32)::BIGINT) % 15)) * 587) +\n        ((240 + (ABS(('x' || SUBSTRING(MD5(e.name || e.id::TEXT || 'B'), 1, 8))::bit(32)::BIGINT) % 15)) * 114)\n      ) / 1000 > 200 THEN '#1A202C'\n      ELSE '#2D3748'\n    END as dynamic_text_color,\n    \n    -- ðŸŽ¯ VORDEFINIERTE TEXTFARBEN fÃ¼r Palette (fÃ¼r besseren Kontrast)\n    CASE (ROW_NUMBER() OVER (ORDER BY e.name) - 1) % 30\n      WHEN 0 THEN '#3730A3'   -- Dunkles Indigo\n      WHEN 1 THEN '#BE185D'   -- Dunkles Rosa\n      WHEN 2 THEN '#065F46'   -- Dunkles GrÃ¼n\n      WHEN 3 THEN '#92400E'   -- Dunkles Gelb\n      WHEN 4 THEN '#1E3A8A'   -- Dunkles Blau\n      WHEN 5 THEN '#581C87'   -- Dunkles Lila\n      WHEN 6 THEN '#166534'   -- Dunkles GrÃ¼n\n      WHEN 7 THEN '#C2410C'   -- Dunkles Orange\n      WHEN 8 THEN '#164E63'   -- Dunkles Cyan\n      WHEN 9 THEN '#BE123C'   -- Dunkles RosÃ©\n      WHEN 10 THEN '#365314'  -- Dunkles Lime\n      WHEN 11 THEN '#A16207'  -- Dunkles Creme\n      WHEN 12 THEN '#4C1D95'  -- Dunkles Violett\n      WHEN 13 THEN '#365314'  -- Dunkles HellgrÃ¼n\n      WHEN 14 THEN '#A16207'  -- Dunkles Zitrone\n      WHEN 15 THEN '#475569'  -- Dunkles Grau\n      WHEN 16 THEN '#92400E'  -- Dunkles Honig\n      WHEN 17 THEN '#3730A3'  -- Dunkles Indigo\n      WHEN 18 THEN '#065F46'  -- Dunkles Smaragd\n      WHEN 19 THEN '#BE185D'  -- Dunkles Magenta\n      -- Erweiterte Textfarben (20-29)\n      WHEN 20 THEN '#7C2D12'  -- Dunkles Braun\n      WHEN 21 THEN '#14532D'  -- Dunkles GrÃ¼n\n      WHEN 22 THEN '#991B1B'  -- Dunkles Rot\n      WHEN 23 THEN '#1E40AF'  -- Dunkles Blau\n      WHEN 24 THEN '#78350F'  -- Dunkles Beige\n      WHEN 25 THEN '#5B21B6'  -- Dunkles Lila\n      WHEN 26 THEN '#A16207'  -- Dunkles Gold\n      WHEN 27 THEN '#0F766E'  -- Dunkles Teal\n      WHEN 28 THEN '#9A3412'  -- Dunkles Orange\n      WHEN 29 THEN '#166534'  -- Dunkles Mint\n      ELSE '#374151'  -- Fallback\n    END as palette_text_color\n\n  FROM public.employees e\n)\n\nSELECT\n    e.name as \"Mitarbeiter\",\n    \n    -- ðŸŽ¨ FARBOPTIONEN (wÃ¤hle eine aus):\n    ec.palette_color as \"Mitarbeiter_Color\",           -- Vordefinierte 30-Farben-Palette\n    -- ec.bg_color as \"Mitarbeiter_Color\",             -- Dynamisch generierte Farben\n    \n    ec.palette_text_color as \"Mitarbeiter_TextColor\",  -- Passende Textfarbe fÃ¼r Palette\n    -- ec.dynamic_text_color as \"Mitarbeiter_TextColor\", -- Textfarbe fÃ¼r dynamische Farben\n    \n    -- Alternative Farben zum Testen\n    ec.bg_color as \"Dynamic_Color\",                    -- Zum Vergleich\n    ec.dynamic_text_color as \"Dynamic_TextColor\",      -- Zum Vergleich\n    \n    -- Direktes Pivot mit der Original-Berechnung\n    ROUND(SUM(CASE WHEN s.day_abbrev = 'Mo' THEN EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60 ELSE 0 END), 1) as \"Montag\",\n    \n    ROUND(SUM(CASE WHEN s.day_abbrev = 'Di' THEN EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60 ELSE 0 END), 1) as \"Dienstag\",\n    \n    ROUND(SUM(CASE WHEN s.day_abbrev = 'Mi' THEN EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60 ELSE 0 END), 1) as \"Mittwoch\",\n    \n    ROUND(SUM(CASE WHEN s.day_abbrev = 'Do' THEN EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60 ELSE 0 END), 1) as \"Donnerstag\",\n    \n    ROUND(SUM(CASE WHEN s.day_abbrev = 'Fr' THEN EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60 ELSE 0 END), 1) as \"Freitag\",\n    \n    -- Gesamtzeit\n    ROUND(SUM(EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60), 1) as \"Gesamt\",\n    \n    -- Stunden:Minuten Format\n    CONCAT(\n        FLOOR(SUM(EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60) / 60), \n        'h ', \n        LPAD(ROUND(SUM(EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60) % 60)::text, 2, '0'), \n        'm'\n    ) as \"Gesamt Stunden\"\n\nFROM public.schedule s\nINNER JOIN public.employees e ON s.employee_id = e.id\nINNER JOIN public.tasks t ON s.task_id = t.id\nLEFT JOIN employee_colors ec ON e.id = ec.employee_id\nWHERE\n    t.id = {{TableStatistics.selectedRow.Task_Id || 1}}\n    AND s.employee_id IS NOT NULL\n\t\tAND s.version_id = {{SelectVersion.selectedOptionValue}}\nGROUP BY e.name, e.id, ec.palette_color, ec.bg_color, ec.palette_text_color, ec.dynamic_text_color\nHAVING SUM(EXTRACT(EPOCH FROM (s.end_time - s.start_time)) / 60) > 0\nORDER BY e.name;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "PhysioPlanung_DEV",
      "isAutoGenerated": false,
      "name": "PhysioPlanung_DEV",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getTaskDetail",
    "pageId": "Reporting",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": true
  }
}