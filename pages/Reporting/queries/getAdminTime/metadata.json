{
  "gitSyncId": "685e483118280a5cf36d2a8a_455ec0fc-19d5-49c7-adbb-59b54c3957b7",
  "id": "Reporting_getAdminTime",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "/*\n * Dieses Skript berechnet die Gesamtzeit (in Minuten), die jeder Mitarbeiter\n * für administrative Aufgaben aufwendet, gruppiert nach Wochentag.\n *\n * Eine \"administrative Aufgabe\" ist dabei eine Aufgabe aus der 'tasks'-Tabelle,\n * deren Name das Wort 'Admin' enthält (Groß- und Kleinschreibung wird ignoriert).\n *\n * Die Logik ist wie folgt aufgebaut:\n * 1. Die Tabellen `schedule`, `employees` und `tasks` werden miteinander verknüpft.\n * 2. Die Einträge werden so gefiltert, dass nur Aufgaben mit 'Admin' im Namen\n * berücksichtigt werden.\n * 3. Für jeden dieser Einträge wird die Dauer (end_time - start_time) berechnet.\n * 4. Das Ergebnis wird nach Mitarbeiter und Wochentag gruppiert und die Dauer\n * aufsummiert, um die Gesamtzeit in Minuten zu erhalten.\n */\nSELECT\n    e.name AS employee_name,\n    -- Wandelt das Kürzel in einen deutschen Wochentagsnamen um.\n    CASE s.day_abbrev\n        WHEN 'MO' THEN 'Montag'\n        WHEN 'DI' THEN 'Dienstag'\n        WHEN 'MI' THEN 'Mittwoch'\n        WHEN 'DO' THEN 'Donnerstag'\n        WHEN 'FR' THEN 'Freitag'\n        WHEN 'SA' THEN 'Samstag'\n        WHEN 'SO' THEN 'Sonntag'\n        ELSE s.day_abbrev\n    END AS weekday,\n    -- Berechnet die Gesamtdauer in Minuten.\n    -- EXTRACT(EPOCH FROM ...) holt die Dauer in Sekunden, die dann durch 60 geteilt wird.\n    SUM(EXTRACT(EPOCH FROM (s.end_time - s.start_time))) / 60 AS total_admin_minutes\nFROM\n    public.schedule s\n    -- Verbinde mit der Mitarbeiter-Tabelle für den Namen.\n    INNER JOIN public.employees e ON s.employee_id = e.id\n    -- Verbinde mit der Aufgaben-Tabelle für den Aufgabennamen.\n    INNER JOIN public.tasks t ON s.task_id = t.id\nWHERE\n    -- Filtert nach Aufgaben, deren Name 'Admin' enthält (ILIKE ignoriert Groß-/Kleinschreibung).\n    t.name ILIKE '%Admin%'\n    AND s.employee_id IS NOT NULL -- Stellt sicher, dass die Aufgabe einem Mitarbeiter zugeordnet ist.\n\t\tAND day_abbrev = {{SelectDay.selectedOptionValue}}\nGROUP BY\n    e.name,\n    s.day_abbrev\nORDER BY\n    employee_name,\n    -- Sortiere nach der korrekten Reihenfolge der Wochentage.\n    CASE s.day_abbrev\n        WHEN 'MO' THEN 1\n        WHEN 'DI' THEN 2\n        WHEN 'MI' THEN 3\n        WHEN 'DO' THEN 4\n        WHEN 'FR' THEN 5\n        WHEN 'SA' THEN 6\n        WHEN 'SO' THEN 7\n    END;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "PhysioPlanung_DEV",
      "isAutoGenerated": false,
      "name": "PhysioPlanung_DEV",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getAdminTime",
    "pageId": "Reporting",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": false
  }
}